from sqlalchemy import create_engine
from sqlalchemy.orm import Session

from app.config import DATABASE_URL


def main():
    engine = create_engine(DATABASE_URL)
    session = Session(bind=engine.connect())

    session.execute("""CREATE TABLE products (
            id INTEGER NOT NULL PRIMARY KEY,
            name VARCHAR(256),
            amount INTEGER,
            unit_type VARCHAR(256),
            added_at VARCHAR(64)
        );""")

    session.execute("""CREATE TABLE dish (
            id INTEGER NOT NULL PRIMARY KEY,
            name VARCHAR(256),
            price INTEGER,
            info VARCHAR(256)
        );""")

    session.execute("""CREATE TABLE recipes (
            recipe_pk INTEGER NOT NULL PRIMARY KEY,
            dish_id INTEGER REFERENCES dish,
            prod_id INTEGER REFERENCES products,
            prod_amount INTEGER
        );""")

    session.execute("""CREATE TABLE pfe (
            id INTEGER NOT NULL PRIMARY KEY,
            empty BOOLEAN
        );""")

    session.execute("""CREATE TABLE orders (
            id INTEGER NOT NULL PRIMARY KEY,
            PFE_id INTEGER REFERENCES pfe,
            added_at VARCHAR(64),
            status VARCHAR(64)
        );""")

    session.execute("""CREATE TABLE order_dish (
            order_pk INTEGER NOT NULL PRIMARY KEY,
            dish_id INTEGER REFERENCES dish,
            order_id INTEGER REFERENCES orders,
            quantity INTEGER
        );""")

    session.close()


if __name__ == "__main__":
    main()
